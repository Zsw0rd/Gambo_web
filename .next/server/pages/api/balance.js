"use strict";(()=>{var e={};e.id=657,e.ids=[657],e.modules={3480:(e,r,t)=>{e.exports=t(5600)},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6330:e=>{e.exports=require("@prisma/client")},6435:(e,r)=>{Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},8667:(e,r)=>{Object.defineProperty(r,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},8800:(e,r,t)=>{t.r(r),t.d(r,{config:()=>d,default:()=>l,routeModule:()=>f});var n={};t.r(n),t.d(n,{default:()=>i});var a=t(3480),s=t(8667),o=t(6435);let u=new(t(6330)).PrismaClient;async function i(e,r){if("POST"!==e.method)return r.status(405).json({error:"Method not allowed"});let{action:t,sessionToken:n,amount:a}=e.body;if(!t||!n)return r.status(400).json({error:"Missing action or sessionToken"});try{let e=function(e){if(!e.startsWith("token-"))return null;let r=e.slice(6),t=r.lastIndexOf("-");return -1===t?null:r.substring(0,t)}(n);if(!e)return r.status(401).json({error:"Invalid or missing session token"});let s=await u.user.findUnique({where:{id:e}});if(!s)return r.status(404).json({error:"User not found"});if("get"===t)return r.status(200).json({balance:s.balance});if("update"!==t)return r.status(400).json({error:"Unknown balance action"});{if("number"!=typeof a)return r.status(400).json({error:"Amount must be a number"});let t=s.balance+a;if(t<0)return r.status(400).json({error:"Insufficient funds!"});let n=await u.user.update({where:{id:e},data:{balance:t}});return r.status(200).json({balance:n.balance})}}catch(e){return console.error(e),r.status(500).json({error:"Server error"})}}let l=(0,o.M)(n,"default"),d=(0,o.M)(n,"config"),f=new a.PagesAPIRouteModule({definition:{kind:s.A.PAGES_API,page:"/api/balance",pathname:"/api/balance",bundlePath:"",filename:""},userland:n})}};var r=require("../../webpack-api-runtime.js");r.C(e);var t=r(r.s=8800);module.exports=t})();